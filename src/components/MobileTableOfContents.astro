---
export interface Props {
  headings: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
}

const { headings } = Astro.props;
const filteredHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <div class="mb-8">
    <details class="group bg-white dark:bg-[#2a2a2a] rounded-lg border border-gray-200 dark:border-white/5 shadow-sm">
      <summary class="flex items-center justify-between p-4 cursor-pointer font-semibold text-gray-900 dark:text-retro-text select-none transition-colors focus:outline-none">
        <div class="flex items-center">
          <span>目次</span>
        </div>
        <svg class="w-5 h-5 text-gray-400 dark:text-gray-500 group-open:rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </summary>
      
      <nav class="px-4 pb-5 pt-1 border-t border-gray-100 dark:border-white/5">
        <ul class="mt-3 space-y-1">
          {filteredHeadings.map((heading) => (
            <li>
              <a 
                href={`#${heading.slug}`} 
                class={`block py-2 transition-colors duration-200 leading-snug border-b border-gray-100 dark:border-white/5 last:border-0
                  ${heading.depth === 2 
                    ? 'text-sm text-gray-700 dark:text-retro-text/90 font-medium pl-1' 
                    : 'text-xs text-gray-600 dark:text-retro-text/70 pl-4'
                  }
                `}
                onclick="this.closest('details').removeAttribute('open')"
              >
                {heading.text}
              </a>
            </li>
          ))}
        </ul>
      </nav>
    </details>
  </div>
)}

<style>
  /* タップ/ホバー時のスタイル */
  a:active {
    @apply text-retro-green dark:text-retro-green-hover bg-gray-50 dark:bg-white/5;
  }
  
  /* Safariでのdetailsのマーカーを消す */
  summary::-webkit-details-marker {
    display: none;
  }
</style>
