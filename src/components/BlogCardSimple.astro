---
import { getMetadata, type LinkMetadata } from '../utils/fetchMetadata';

export interface Props {
  href: string;
  title?: string;
  description?: string;
  metadata?: LinkMetadata;
}

const { href, title: providedTitle, description: providedDescription, metadata: providedMetadata } = Astro.props;

// メタデータを取得（提供された値 > 事前定義 > フォールバック）
const metadata = providedMetadata || getMetadata(href);

const isExternal = !href.startsWith('/') && !href.startsWith('#');
const domain = (() => {
  try {
    const url = new URL(href);
    return url.hostname.replace('www.', '');
  } catch {
    return href;
  }
})();

// 最終的な値を決定（Props > metadata > フォールバック）
const title = providedTitle || metadata?.title || domain;
const description = providedDescription || metadata?.description || '';
const siteName = metadata?.siteName || domain;
---

<div class="blog-card-simple">
  <a 
    href={href}
    class="block group no-underline hover:no-underline"
    target={isExternal ? "_blank" : undefined}
    rel={isExternal ? "noopener noreferrer" : undefined}
  >
    <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-800 hover:border-blue-300 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 transition-all duration-200 relative">
      <!-- 右上の矢印アイコン -->
      <svg class="absolute top-4 right-4 w-4 h-4 text-gray-400 dark:text-gray-500 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
      
      <!-- タイトル -->
      <div class="text-base font-medium text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors line-clamp-1 pr-6">
        {title}
      </div>
      
      <!-- 説明文 -->
      {description && (
        <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-2 pr-6">
          {description}
        </p>
      )}
      
      <!-- URL表示 -->
      <div class="flex items-center text-xs text-gray-400 dark:text-gray-500">
        <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
        </svg>
        <span class="truncate" title={href}>
          {href.length > 50 ? href.substring(0, 47) + '...' : href}
        </span>
      </div>
    </div>
  </a>
</div>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* プロースタイルのオーバーライド */
  .blog-card-simple a {
    text-decoration: none !important;
    color: inherit !important;
  }
  
  .blog-card-simple a:hover {
    text-decoration: none !important;
  }
</style>